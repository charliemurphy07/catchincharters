<?php 
/**
* @file
* Module file for block_example.
*/

/**
* Implements hook_block_info().
*
* This hook declares what blocks are provided by the module.
*/
function homepage_rotator_block_info() {
	// This hook returns an array, each component of which is an array of block
	// information. The array keys are the 'delta' values used in other block
	// hooks.
	// The required block information is a block description, which is shown
	// to the site administrator in the list of possible blocks. You can also
	// provide initial settings for block weight, status, etc.
	// Many options are defined in hook_block_info():
	$blocks['homepage_rotator'] = array(
		// info: The name of the block.
		'info' => t('Recent Trips'),
		// Block caching options (per role, per user, etc.)
		'cache' => DRUPAL_CACHE_PER_ROLE, // default
	);
	return $blocks;
}

/**
* Implements hook_block_view().
*
* This hook generates the contents of the blocks themselves.
*/
function homepage_rotator_block_view($delta = '') {
	$block = array();
	//The $delta parameter tells us which block is being requested.
	switch ($delta) {
		case 'homepage_rotator':
		// The subject is displayed at the top of the block. Note that it
		// should be passed through t() for translation. The title configured
		// for the block using Drupal UI supercedes this one.
		$block['subject'] = t('Recent Trips');
		// The content of the block is typically generated by calling a custom
		// function.
		$block['content'] = homepage_rotator_contents();
		break;
	}
	return $block;
}

/**
* A module-defined block content function.
*/
function homepage_rotator_contents() {
	$result = db_query("SELECT n.nid FROM {node} n INNER JOIN {nodequeue_nodes} nn ON n.nid = nn.nid WHERE nn.qid = :qid AND n.status = 1 ORDER BY nn.position", array(':qid' => 1));
	//We should move this HTML and use a theme function but this isn't too terribly bad IMO.
	$content = '<div id="slides"><div class="slides_container">';
	foreach($result as $nid){
		$node = node_load($nid->nid);
		foreach ($node->field_image['und'] as $image){
			//$path = drupal_realpath($image['uri'])
			$path = image_style_url('homepage_rotator', $image['uri']);
			$content .= '<img src='. $path .'/>';	
		}
		$content .= '</div></div>';
	}
	return $content;

	return;
}
/**
* @} End of "defgroup block_example".
*/ 
/*

function homepage_rotator_block_info(){
	$blocks = array();
	
    $blocks['homepage_rotator'] = array(
    	'info' => t('Recent Trips'),
    );
    
    return $blocks;
}

function homepage_rotator_block_view($delta = ''){
 switch ($delta) {
    case 'homepage_rotator':
      $block['subject'] = t('Recent Trips');
      $block['content'] = homepage_rotator_content();
      break;
     }
  return $block;
}

function homepage_rotator_content(){
	//$result = db_query("SELECT n.nid FROM {node} n INNER JOIN {nodequeue_nodes} nn ON n.nid = nn.nid WHERE nn.qid = %d AND n.status = 1 ORDER BY nn.position", 1);
	//$n = db_fetch_object($result);
	//$node = node_load($n->nid);
	//print_r($node);exit;
	return 'Hello';
}
*/


